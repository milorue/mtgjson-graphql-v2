# Contributing to MTGGraphQL

Welcome to the contribution document for MTGJSON GraphQL, hopefully you're here because you have an interest in improving our software with your mad coding skills and/or just simply interested in the project.

If you're not a programmer, but still want to help in whatever way you can, we are always looking for rockstars like yourself to audit our content. We also appreciate financial contributions to help keep this API up and running via [PayPal](https://www.paypal.me/zachhalpern) and [Patreon](https://patreon.com/mtgjson).

## Environment Setup

For MTGJSON GraphQL I personally recommend utilizing [VSCode](https://code.visualstudio.com/) due to it's versatility and extension library but [PyCharm](https://jetbrains.com/pycharm/) is also used by other developers on the team so any IDE should do the trick.

In addition to an IDE you will need a [Node.js](https://nodejs.org/en/download/) environment set up and installed, there are guides online and and node's website to install for your specific OS.

`npm install` once you have cloned the repository will install the dependencies needed to run the project.

It is recommended if you are going to be running this project locally that you have a PostgreSQL database already set up either locally or on a server to then add a `.env` file with the following info.

```
DEV_MODE=true
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres (or whatever you want)
DB_PASS=<password>
DB_DATABASE=mtgjson (or whatever you want)

EMAIL_USER=test@gmail.com
EMAIL_PASS=asdf1234
```

For the email service it can get complicated where the email service may need to allow less-secure apps you can learn more about this [here](https://support.google.com/accounts/answer/6010255?hl=en).

The .env file may be updated in future development and it will be accurately updated in the README and here.

## Project Structure

The overall codebase is split up into different folders and files based on their purpose and overall functionality within the codebase.

There are 2 folders that don't come by default in the main directory with `node_modules` being generated by `npm install` & `log` directory being generated by the internal logging service within the actual gql server.

From the main directory there are a 2 directories & a number of files:

- `assets/` is a directory for images and other assets to be placed for the README and other documents
- `src/` is the main directory where all the source code sits and runs from. To see the guts of the project look here.
- `server.ts` is the file that when run starts up the gql apollo server and runs the whole thing.
- `tsconfig.json` is the Typescript configuration file so that our code can compile correctly in Typescript, usage of Typescript within this repository is mandatory.
- `schema.gql` is the graphql schema file generated by TypeGraphQL if you are interested in using a library like GraphQL CodeGen for client applications or simply want to understand what the data types are without reading through the Typescript & Decorator based entities in `src/entities/`

Within the `src/` directory different folders split up the functionality of the server and where database and graphql fields are defined, utilized and accessed.

- `entities/` is the actual database entities & graphql fields with their corresponding types. Files within this directory should follow [TypeORM](https://typeorm.io/#/) & [TypeGraphQL](https://typegraphql.com/) standard decorators & syntax
- `inputs/` is where standardized graphql input types are placed so for example something that multiple queries or mutations might use as an input (ex: pagination) go here.
- `resolvers/` is where the graphql resolvers (queries, mutations, subscriptions) reside. They are split up by the entity that they manage and further split up into folders of single retrieval & list retrieval. Each subfolder should have a named file that actually builds the resolvers from functions in sub-folders named `<entity>.resolver.ts` (ex: `Card.resolver.ts`)
- `types/` is where typescript types, enums, & interfaces reside for helping with autocomplete and error catching. Some gql scalar types also reside here.
- `util/` is where utility functions & services reside and is split up into a number of important processes.
    - `auth` is where token validation & query validation takes place
    - `ingest` is where the mtggraphql server commands to ingest the mtg data into the psql database reside. You can find a number of command to ingest within the `package.json` file but `npm run ingest-database` is the main one to ingest all the other individual ingestors. You may run into memory issues with this if using limited RAM and may need to run the commands individually.
    - `services` is where services that perform actions like email sending, token generation, etc. reside. If you want to build a new service please place it within this folder/
    - `ConnectDatabase.ts` is the file that connects to the psql database
    - `CreateSchema.ts` is the utility function to build the gql schema from the entity files.
    - `Logger.ts` is the logging mechanism to write internal messages to file and to Sentry.io if its set up.
    - `Sentry.ts` is a skeleton implementation of sentry for future use.

    ## Communication Channels
    We primarily communicate over [Discord](https://mtgjson.com/discord). Feel free to join us, whether a developer or not. We love chatting with the community!

    MTGJSON staff can be identified with a blue name, and our staff listing is found on the [website](https://mtgjson.com/).